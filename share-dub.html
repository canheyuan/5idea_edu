<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0,user-scalable=0" />
<meta content="yes" name="apple-mobile-web-app-capable">
<meta content="black" name="apple-mobile-web-app-status-bar-style">
<meta content="telephone=no" name="format-detection">
<title></title>
<link rel="stylesheet" href="static/css/reset.css">
<link rel="stylesheet" href="static/css/share.css">
<script src="static/js/conversion.750.js"></script>
<script src="static/js/zepto.min.js" charset="utf-8"></script>
<script src="static/js/vue.js" charset="utf-8"></script>
<script src="static/js/shell.js" charset="utf-8"></script>
<script>
Shell.init();
</script>
</head>

<body class="gray_body">
<div id="app" v-cloak>


<!--顶部提示下载-->
<div class="share_top clearfix">
	<div class="logo"><img src="static/images/logo.png" alt=""></div>
	<a href="javascript:;" class="down_btn">Download</a>
	<div class="info">
		<h3>CHIease</h3>
		<p>懂汉语，你就是下一位封面人物两行样式</p>
	</div>
	<span class="close_btn"><i class="icons"></i></span>
</div>
	
<!--配音课头部-->
<div class="dub_head">
	<div class="dub_video">
		<div class="title" id="videoTitle">{{checkShareData.chapterName.zh}}</div>
		<video id="video" :src="checkShareData.video" muted="true"  x5-video-player-type="h5" playsinline webkit-playsinline="true"></video>
		<img class="play_btn" id="playBtn" src="static/images/ico_play.png" alt="">
	</div>
	<div class="share_score">
	  	<div class="score_top">
			<p class="txt">本段配音得分<br>超过了<span>{{checkShareData.accuracyScore}}%</span>的用户</p>
			<div class="score_num">{{checkShareData.score}}</div>
			<a class="btn" href="javascript:;">我要挑战</a>
		</div>
		<div class="score_box">
			<ul class="score_list clearfix">
				<li class="yellow"><span>{{checkShareData.rhythmScore}}</span><p>发音</p></li>
				<li class="green"><span>{{checkShareData.fluencyScore}}</span><p>流畅度</p></li>
				<li class="blue"><span>{{checkShareData.integrityScore}}</span><p>完整度</p></li>
				<li class="red"><span>{{checkShareData.accuracyScore}}</span><p>正确率</p></li>
			</ul>
		</div>
	</div>
</div>

<!--录音列表-->
<div class="share_record">
	<div class="record_title"><i class="icons ico_zan"></i>表现最佳的句子</div>
	<div class="record_list">
		
		<div class="record_item" v-for="(item,index) in checkShareData.paraList">
			<h4 class="tit">{{item.content.zh}}</h4>
			<ul class="audio_list">
				<li>
					<div class="play_box" @click="playAudio('user',index)">
						<img :src="checkShareData.headImg" alt="">
						<div class="mask"></div>
						<i :class="item.isUserPlay?'icons ico_stop':'icons ico_play'"></i>
					</div>
					<div class="text">我的录音 - <span class="orange">{{item.score}}分</span></div>
					
				</li>
				<li>
					<div class="play_box" @click="playAudio('para',index)">
						<i :class="item.isParaPlay?'icons ico_stop':'icons ico_play'"></i>
						<div class="progress"></div>
					</div>
					<div class="text">原音</div>
				</li>
			</ul>
		</div>
		<audio id="spokenAudio" class="audio" :src="shareMediaUrl"></audio>
		
<!--
		<div class="record_item">
			<h4 class="tit"><span class="blue">如果我了解更多中国的文化</span>就好了，<span class="blue">我想看《金瓶梅》</span>没文化会看不懂的，嚎~</h4>
			<ul class="audio_list">
				<li>
					<div class="play_box">
						<img src="static/images/per_img.jpg" alt="">
						<div class="mask"></div>
						<i class="icons ico_play"></i>
					</div>
					<div class="text">我的录音 - <span class="orange">90分</span></div>
				</li>
				<li>
					<div class="play_box">
						<i class="icons ico_play"></i>
						<div class="progress"></div>
					</div>
					<div class="text">原音</div>
				</li>
			</ul>
		</div>
-->
		
	</div>
</div>

<!--下载-->
<div class="download_mdl">
	<div class="down_head">
		<div class="title">
			<h3>CHIease | 听说读写</h3>
			<p>以点起步，以线过渡，以面全面巩固</p>
		</div>
		<img class="head_img" src="static/images/share_img01.jpg" alt="">
	</div>
	<div class="down_btns">
		<a class="apply_btn" href="javascript:;">
			<i class="icons ico_apply"></i>
			<h4>Download</h4>
			<p>on the App Store</p>
		</a>
		<a class="android_btn" href="javascript:;">
			<i class="icons ico_android"></i>
			<h4>Download</h4>
			<p>on the Google Play</p>
		</a>
	</div>
</div>
	
	
</div>
<script src="static/js/common.js"></script>
<script>
	
//vue实例加载完后执行的函数
function vmCreated(){

	//设置页面标题栏
	var param = {
		name: "share-spoken",
		title: '配音课分享',	
		leftIcon: "back",		//or "close" ，缺省即back
		backgroundColor: "#00ffffff"	//不设则默认白色
	}
	Shell.setPageTitle(JSON.stringify(param));
	$('title').text('配音课分享');
	
	common.ajaxFn({
		url:`/api/shareInfo/dubChaShareInfo/${common.shareId}`,
		success:(res)=>{
			var datas =  res.data;
			datas.paraList.forEach(item=>{
				item.isUserPlay = false;
				item.isParaPlay = false;
			});
			vm.checkShareData = datas;
			
			//给ul父级设置个宽度
			var ul_width = 5;
			$('.score_list li').each(function(i){
				var thisW = $(this).width();
				var thisML = parseFloat($(this).css('margin-left'));
				ul_width = ul_width + thisW + thisML;
			})
			$('.score_list').width(ul_width);

			//视频播放
			var videoObj = $('#video').get(0);
			$('#playBtn').on('click',function(){
				videoObj.play();
			});

			$('#video').on('click',function(){
				 if(videoObj.paused){ //如果已暂停则播放
					videoObj.play(); //播放控制
				}else{ // 已播放点击则暂停
					videoObj.pause(); //暂停控制
				}
			});
			
			//监听视频播放触发
			videoObj.addEventListener("play",function(){
				$('#playBtn').hide();
				$('#videoTitle').hide();
			},false);
			//监听暂停触发
			videoObj.addEventListener("pause",function(){
				$('#playBtn').show();
				$('#videoTitle').show();
			},false);
			
			//监听音频停止事件
			var spokenAudio = $('#spokenAudio').get(0);
			spokenAudio.addEventListener("pause",function(){
				var audioDataList = vm.checkShareData.paraList;
				audioDataList.forEach(item=>{
					item.isUserPlay = false;
					item.isParaPlay = false;
				});
			},false);	
		}
	});
}


$(function(){
	
	//获取用户id再执行函数
	Shell.getSessionId(function(res){
		common.sessionId = res;
		common.vueIsLoad && vmCreated && vmCreated();
	});
	
});
</script>
</body>
</html>
